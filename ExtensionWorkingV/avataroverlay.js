let overlayInitialized = false;window.addEventListener('message', (event) => {  if (event.data?.type === 'OPEN_AVATAR_OVERLAY') {    if (!overlayInitialized) {      createAvatarOverlay();      overlayInitialized = true;    } else {      document.getElementById('avatar-overlay').style.display = 'flex';    }  }});function createAvatarOverlay() {  const overlay = document.createElement('div');  overlay.id = 'avatar-overlay';  overlay.style = `    position: fixed;    top: 0; left: 0;    width: 100vw; height: 100vh;    background-color: rgba(210, 180, 140, 0.95);    z-index: 999999;    display: flex;    flex-direction: row;    font-family: Georgia, serif;  `;  const sidebar = document.createElement('div');  sidebar.style = `    width: 200px;    background: #222;    color: white;    overflow-y: auto;    padding: 10px;    display: flex;    flex-direction: column;    gap: 8px;  `;  const categories = [    "Human", "Elf", "Half-Elf", "Dwarf", "Halfling", "Fiends", "Half-Orc", "Orc",    "Hobgoblin", "Drow", "Duegar", "Ogre", "Goblin", "Giths", "Illithid",    "Undead", "Legends", "Other"  ];  categories.forEach(category => {    const btn = document.createElement('button');    btn.textContent = category;    btn.style = `      padding: 8px;      background: #444;      color: white;      border: none;      cursor: pointer;      text-align: left;    `;    btn.addEventListener('click', () => loadAvatars(category));    sidebar.appendChild(btn);  });  const contentArea = document.createElement('div');  contentArea.id = 'avatar-content';  contentArea.style = `    flex: 1;    padding: 10px;    display: grid;    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));    gap: 10px;    overflow-y: auto;  `;  const closeBtn = document.createElement('button');  closeBtn.textContent = 'Close';  closeBtn.style = `    position: absolute;    top: 10px; right: 10px;    background: darkred;    color: white;    border: none;    padding: 6px 10px;    cursor: pointer;    z-index: 10000;  `;  closeBtn.onclick = () => {    overlay.style.display = 'none';  };  overlay.appendChild(sidebar);  overlay.appendChild(contentArea);  overlay.appendChild(closeBtn);  document.body.appendChild(overlay);}function loadAvatars(category) {  const container = document.getElementById('avatar-content');  container.innerHTML = '';  const maxImages = 50;  const folder = category.toLowerCase();  for (let i = 1; i <= maxImages; i++) {    const path = `avatars/${folder}/${i}.jpg`;    const resolvedSrc = chrome.runtime.getURL(path);    const img = document.createElement('img');    img.src = resolvedSrc;    img.alt = `${category} ${i}`;    img.style = `      width: 100%;      height: auto;      cursor: pointer;      border: 2px solid transparent;    `;    img.onerror = () => {      img.remove();    };    img.onclick = () => {      const iframe = Array.from(document.querySelectorAll('iframe'))        .find(f => f.src.includes('ui.html'));      if (iframe && iframe.contentWindow) {        console.log('[avatarOverlay.js] Sending SET_AVATAR:', path);        iframe.contentWindow.postMessage({          type: 'SET_AVATAR',          src: path // NOT the full resolved path        }, '*');      } else {        console.warn('[avatarOverlay.js] Could not find UI iframe!');      }      document.getElementById('avatar-overlay').style.display = 'none';    };    container.appendChild(img);  }}